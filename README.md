
# WEB API WITH SWAGGER (2018)

An application that exposes web api url, by leveraging Swagger, ElasticSearch and ASP.NET Core.

Postman client to test available web api endpoint :

![alt capture1](https://github.com/danmgs/Elasticsearch-Nodejs.Quickstart/blob/master/img/screenshot1.PNG)

## Folders Organisation

### Overview

Schema below will show the main elements :

```
| -- /Api.Demo.Core
     | -- /Interfaces
          | -- IManagerClient.cs
          | -- ISearchClient.cs
     | -- AbsractBaseElastic.cs
     | -- ElasticManagerClient.cs
     | -- ElasticSearchClient.cs 

| -- /Api.Demo.Models                     -> contains all models shared accross projects

| -- /Api.Demo.Tests
     | -- /Controllers
          | -- ProductControllerTest.cs
     | -- /Elastic
          | -- ElasticMonitorClientTest.cs
          | -- ElasticSearchClientTest.cs

| -- /WebApplicationDotNetCore
     | -- /Controllers 
     | -- /Models                         -> contains all web app specific models
          | -- /Config                    -> contains all models for web app settings
     | -- /Views 
     | -- appsettings.json
     | -- bower.json
     | -- bundleconfig.json
     | -- Program.cs
     | -- Startup.cs              

```

## Prerequisites and setup

### Seed ElastictSearch cluster with data.

1. Start elasticsearch cluster first.

2. In order to create the **product** index, the data file is available in **SolutionItems\datasamples** directory. 

Command to bulk insert products from file **products-bulk.json** under kibana dev tool :
```
POST /product/default/_bulk
[put here file content]
```

## How To

### a. Generate the swagger client proxy :

http://editor.swagger.io/  (copy content from http://localhost:53626/swagger/v1/swagger.json via postman)
or
java -jar swagger-codegen-cli-2.2.1.jar generate -i http://localhost:53626/swagger/v1/swagger.json -l csharp


https://dzimchuk.net/generating-clients-for-your-apis-with-autorest/

https://github.com/Azure/autorest/blob/master/docs/generating-a-client.md

Generate proxy client with autorest
C:\Apps\Tools\Autorest>autorest --input-file=swagger.yaml --csharp --output-folder=CSharp_MyClient --namespace=MyClientNamesp

Use of client (configuration url ..etc)
http://visualbean.io/blog/how-to-use-the-autogenerated-swagger-client/

## Useful Links

### Swagger
https://scotch.io/tutorials/speed-up-your-restful-api-development-in-node-js-with-swagger

https://docs.microsoft.com/en-us/aspnet/core/migration/webapi

https://docs.microsoft.com/en-us/aspnet/core/tutorials/web-api-help-pages-using-swagger?tabs=visual-studio-mac%2Cvisual-studio

https://stackoverflow.com/questions/227624/asp-net-mvc-controller-actions-that-return-json-or-partial-html

https://docs.microsoft.com/en-us/aspnet/core/tutorials/web-api-help-pages-using-swagger?tabs=visual-studio

https://github.com/domaindrivendev/Swashbuckle.AspNetCore

https://github.com/swagger-api/swagger-codegen


### Intro ASP.NET Core
http://rdonfack.developpez.com/tutoriels/dotnet/nouveautes-aspnet-core-2/

### Dependency Injection
https://hassantariqblog.wordpress.com/2017/02/20/asp-net-core-step-by-step-guide-to-access-appsettings-json-in-web-project-and-class-library/
https://cmatskas.com/net-core-dependency-injection-with-constructor-parameters-2/

### ASP.NET Core Routing
https://docs.microsoft.com/en-us/aspnet/core/fundamentals/routing
https://stormpath.com/blog/routing-in-asp-net-core

### ElasticSearch Nest C#
https://github.com/youthpassion0732/ElasticSearchConsoleApp
https://hassantariqblog.wordpress.com/2016/09/21/elastic-search-getting-document-using-nest-in-net/
https://www.devbridge.com/articles/getting-started-with-elastic-using-net-nest-library-part-two/#

### Hosting in .NET Core (Program.cs)
https://docs.microsoft.com/fr-fr/aspnet/core/fundamentals/hosting?tabs=aspnetcore2x

### Bower
https://msdn.microsoft.com/fr-fr/magazine/mt573714.aspx

### AOP logging
https://dotnetthoughts.net/aop-with-aspnet-core/


## TODO

- [ ] id "00000000-0000-0000-0000-000000000000" (GUID), id not retrieving.

- [ ] startup config retrive config (es index + es url) to create clients

- [ ] review routing

- [ ] voir comment specifier loption fuzzyness pour la recherche (approximate search)
http://localhost:53626/api/product/search/big => should return some results with "bag".

